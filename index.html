<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <!-- O cabeçalho permanece o mesmo -->
  <!-- ... -->
</head>
<body>
  <!-- O corpo do HTML permanece o mesmo -->
  <!-- ... -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
  <script>
    // Configuração do GitHub
    const GITHUB_TOKEN = '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';
    const REPO_OWNER = 'LeandroBiazzo';
    const REPO_NAME = 'Reserva-Definitivo';
    const FILE_PATH = 'agendamentos.json';

    // O resto das variáveis permanece o mesmo
    const form = document.getElementById('agendamentoForm');
    // ...

    // Funções para interagir com o GitHub
    async function getAgendamentos() {
      try {
        const response = await axios.get(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`, {
          headers: { 'Authorization': `token ${GITHUB_TOKEN}` }
        });
        const content = atob(response.data.content);
        return { data: JSON.parse(content), sha: response.data.sha };
      } catch (error) {
        console.error('Erro ao obter agendamentos:', error);
        return { data: [], sha: null };
      }
    }

    async function saveAgendamentos(agendamentos, sha) {
      try {
        const content = btoa(JSON.stringify(agendamentos, null, 2));
        await axios.put(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`, {
          message: 'Atualizar agendamentos',
          content: content,
          sha: sha
        }, {
          headers: { 'Authorization': `token ${GITHUB_TOKEN}` }
        });
      } catch (error) {
        console.error('Erro ao salvar agendamentos:', error);
        throw error;
      }
    }

    // Função para carregar agendamentos do GitHub
    async function carregarAgendamentos() {
      try {
        const { data, sha } = await getAgendamentos();
        agendamentos = data;
        atualizarListaAgendamentos();
      } catch (error) {
        console.error('Erro ao carregar agendamentos:', error);
      }
    }

    // Chamar carregarAgendamentos no início para carregar os agendamentos existentes
    carregarAgendamentos();

    // O resto das funções permanece o mesmo, mas precisamos modificar algumas para usar o GitHub

    form.addEventListener('submit', async function(event) {
      event.preventDefault();

      // ... (o código para capturar os dados do formulário permanece o mesmo)

      try {
        const { data: agendamentosAtuais, sha } = await getAgendamentos();
        
        if (editIndex >= 0) {
          agendamentosAtuais[editIndex] = { finalidade, solicitante, nomeSolicitante, sala, data: dataUTC.toISOString(), hora, tema, banca, orientador, motivo };
          editIndex = -1;
          agendarButton.textContent = 'AGENDAR';
        } else {
          agendamentosAtuais.push({ finalidade, solicitante, nomeSolicitante, sala, data: dataUTC.toISOString(), hora, tema, banca, orientador, motivo });
        }

        await saveAgendamentos(agendamentosAtuais, sha);
        agendamentos = agendamentosAtuais;
        atualizarListaAgendamentos();
        alert('AGENDAMENTO REALIZADO COM SUCESSO!');

        form.reset();
        tccFields.classList.add('hidden');
        manutencaoFields.classList.add('hidden');
      } catch (error) {
        console.error('Erro ao salvar agendamento:', error);
        alert('ERRO AO SALVAR AGENDAMENTO. POR FAVOR, TENTE NOVAMENTE.');
      }
    });

    // Modificar a função excluirAgendamento para usar o GitHub
    async function excluirAgendamento(index, nomeSolicitante) {
      const nomeUsuarioAtual = prompt('PARA EXCLUIR, DIGITE O SEU NOME:');

      if (nomeUsuarioAtual === nomeSolicitante) {
        try {
          const { data: agendamentosAtuais, sha } = await getAgendamentos();
          agendamentosAtuais.splice(index, 1);
          await saveAgendamentos(agendamentosAtuais, sha);
          agendamentos = agendamentosAtuais;
          atualizarListaAgendamentos();
          alert('AGENDAMENTO EXCLUÍDO COM SUCESSO!');
        } catch (error) {
          console.error('Erro ao excluir agendamento:', error);
          alert('ERRO AO EXCLUIR AGENDAMENTO. POR FAVOR, TENTE NOVAMENTE.');
        }
      } else {
        alert('VOCÊ SÓ PODE EXCLUIR SEUS PRÓPRIOS AGENDAMENTOS.');
      }
    }

    // O resto do código permanece o mesmo
    // ...

  </script>
</body>
</html>
